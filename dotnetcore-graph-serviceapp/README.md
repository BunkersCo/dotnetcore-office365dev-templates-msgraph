# Microsoft Graph Deamon Application Template

English | [简体中文](https://github.com/chenxizhang/dotnetcore-office365dev-templates/blob/master/dotnetcore-graph-serviceapp/lang/zh-cn/README.md) | [繁體中文](https://github.com/chenxizhang/dotnetcore-office365dev-templates/blob/master/dotnetcore-graph-serviceapp/lang/zh-tw/README.md)

> Author：Ares Chen @ 2018/4/22

## Overview

A deamon application refers to a type of application that does not require user interaction. They are likely to run in the background with a timer. Due to this feature, they often do not access a Microsoft Graph as a specific user, but rather as a fixed identity. In this project template, we implement the standard Client Credential authentication process in Oauth 2.0, that is, the application uses its own application number (`clientid`), and a key (`secret`) to indicate its own Identity, and the permissions it gets, after being confirmed by the Office 365 administrator, can access any user's data.

This template implements five basic functions

1. Read all user information
1. Read a user's inbox mailing list
1. Read the file list of a user's personal network disk root directory
1. Send mail on behalf of a user
1. Upload a text file to a user's personal web drive

## Prerequisites

In order to use this template, you'd better be able to register an application yourself. If you are not familiar with this concept, please refer to the description of [Microsoft Graph overview] (https://github.com/chenxizhang/office365dev/blob/master/docs/microsoftgraphoverview.md).

If you need to access the international version of Office 365, it is recommended that you directly use the AAD 2.0 registration method to register at <https://apps.dev.microsoft.com>. Please refer to [this article] (https://github) .com/chenxizhang/office365dev/blob/master/docs/applicationregisteration2.0.md).

If you need to access the domestic version of Office 365, you can only use the AAD 1.0 registration method to register at <https://portal.azure.cn>, please refer to [this article] (https://github. Com/chenxizhang/office365dev/blob/master/docs/applicationregisteration.md).

This template example requires at least five application permissions

1. Files.Read.All（Admin）
1. Mail.Read（Admin）
1. User.Read.All(Admin)
1. Mail.Send(Admin)
1. File.ReadWrite.All(Admin)

Please note that this type of application permission requires an "Admin consent" from Office 365 management. After the project is generated, there will be operational hints in this area.

## How to install the template

You can install this template through `dotnet new -i chenxizhang.dotnetcore.msgraph.serviceapp.CSharp`.

## How to use the template

The project template defines five parameters, which are as follows

1. `instance`, used to define the version of the target Office 365 environment, `global` for the international version (default), and `gallatin` for the domestic version.
1. `clientid`, the application number obtained when registering the application.
1. `secret`, the key generated when registering the application.
1. `tenantid` specifies the tenant id you want to access last. Unlike delegated permissions, application permissions must be explicitly limited to specific tenants rather than multi-tenants. There are several ways to get this tenantid, one is when you are doing Admin consent, and there is this information in the address column of the returned result. You can also get it through the PowerShell method described in [my article] (http://www.cnblogs.com/cn/xixizhang/p/7904293.html).
1. `version` specifies the version of the Graph API you want to access. The default is `v1.0` and currently supports `beta`.

If you are not quite sure how to register the application and how to do Admin consent, you can directly run the most basic command `dotnet new graphserviceapp` and use the environment I have configured to experience these functions.
> My test environment is often modified and may be expired, so you may experience situations where you are unable to work properly.

The regular use of this template is to specify at least the first four parameters, such as `dotnet new graphserviceapp --instance gallatin --clientid your-application-id --secret your-secret --tenantid your-tenantid`.

There are also two common parameters

1. By specifying `name` you can change the name of the project generated by the template, as well as the default namespace name. For example, `dotnet new graphserviceapp -n myserviceapp`.
1. You can specify to generate a new project directory by specifying `output`. For example, `dotnet new graphserviceapp -o testapp`.

In addition, please note that after the project is generated, you can't directly run `dotnet run`, but at least modify two lines of code (lines 72, 73) to set the user upn and mail recipient information you want to access.

## How to uninstall the template

You can uninstall this template through `dotnet new -u chenxizhang.dotnetcore.msgraph.serviceapp.CSharp`.