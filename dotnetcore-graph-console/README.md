# Microsoft Graph Console Application Template

English | [简体中文](https://github.com/chenxizhang/dotnetcore-office365dev-templates/blob/master/dotnetcore-graph-console/lang/zh-cn/README.md) | [繁體中文](https://github.com/chenxizhang/dotnetcore-office365dev-templates/blob/master/dotnetcore-graph-console/lang/zh-tw/README.md)

> Author：Ares Chen @ 2018/4/22

## Overview

This project template can help you quickly build a console application and call a Microsoft Graph service on-behalf of a user, The template implementing the following three functions:

1. Read the basic information of the current user
1. Read the first ten messages in the current user's mailbox inbox (Exchange Online)
1. Read the list of files under the root directory of the current user's OneDrive for Business

Since .NET Core is to be cross-platform, the pop-up window provided in the native Windows operating system cannot be used for user login. This template is implemented in a special way. After the program runs, a `device code` will be automatically generated and the user will be prompted with a login webpage address. The user enters the `device code` on the webpage and will be directed to the corresponding Office 365 landing page. After the authentication and authorization are completed, the console program is executed. You will receive the notification and get the Access Token. Then you can invoke the Microsoft Graph.

The template supports both `global` and `gallatin` office 365 environment.

## Prerequisites

In order to use this template, you'd better be able to register an application yourself. If you are not familiar with this concept, please refer to the description of [Microsoft Graph overview] (https://github.com/chenxizhang/office365dev/blob/master/docs/microsoftgraphoverview.md).

If you need to access the international version of Office 365, it is recommended that you directly use the AAD 2.0 registration method to register at <https://apps.dev.microsoft.com>. Please refer to [this article] (https://github) .com/chenxizhang/office365dev/blob/master/docs/applicationregisteration2.0.md).

If you need to access the domestic version of Office 365, you can only use the AAD 1.0 registration method to register at <https://portal.azure.cn>, please refer to [this article] (https://github. Com/chenxizhang/office365dev/blob/master/docs/applicationregisteration.md).

This template example requires at least three delegated permissions

1. Files.Read.All
1. Mail.Read
1. User.Read

## How to install the template

You can install this template through `dotnet new -i chenxizhang.dotnetcore.msgraph.console.CSharp`.

## How to use the template

There are several scenarios for this template, as follows

1. The simplest usage of `dotnet new graphconsole` will create a template implementation, and you will use the clientid I ​​created in advance to access Office 365 International.
1. By explicitly specifying the `clientid` parameter, explicitly use your application to access Office 365. This is my most recommended, the syntax is `dotnet new graphconsole --clientid' the-applicationid-you-created`.
1. With the `instance` parameter, specify whether you want to access the ``global`` or ``gallatin`` version. The ``global`` version is the default, and if you want to specify the ``gallatin`` version, you need to use the following syntax: `dotnet new graphconsole --instance gallatin --clientid the-applicationid-you-created`.
1. Specify the version of the Graph API you want to access via the `version` parameter. The default is `v1.0`. Currently `beta` is also supported.

There are also two common parameters

1. By specifying `name` you can change the name of the project generated by the template, as well as the default namespace name. For example, `dotnet new graphconsole -n mynamespace`.
1. You can specify to generate a new project directory by specifying `output`. For example, `dotnet new graphconsole -o test`.

Once the project is created, you can run it directly from `dotnet run` or edit it in `Visual Studio Code` and run it again.

## How to uninstall the template

You can uninstall this template through `dotnet new -u chenxizhang.dotnetcore.msgraph.console.CSharp`.